<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ld.gg.dao.Summoner_dao">

   <select id="getRankLoadingData" resultType="summoner_rank">
	SELECT DISTINCT
    sr.summoner_name,
    si.profile_icon_id,
    si.s_level,
    LOWER(sr.tier) as tier,
    sr.division,
    sr.wins,
    sr.losses,
    sr.lp,
    ROUND((sr.wins / (si.games)) * 100, 2) as winrate
	FROM summoner_rank sr
	INNER JOIN summoner_info si ON sr.summoner_name = si.summoner_name
	WHERE sr.queue = 'RANKED_SOLO_5x5' AND LOWER(sr.tier) IN ('challenger', 'grandmaster', 'master')
	AND si.revision_date = (SELECT MAX(revision_date) FROM summoner_info WHERE summoner_name = sr.summoner_name)
	ORDER BY sr.lp DESC;
   </select>

   <select id="getRankSoloData" resultType="summoner_rank">
      SELECT sr.summoner_name,
      si.profile_icon_id, si.s_level, LOWER(sr.tier) as tier, sr.division,
      sr.wins, sr.losses, sr.lp, round((sr.wins/(si.games))*100,2) as
      winrate
      FROM summoner_rank sr
      INNER JOIN summoner_info si ON
      sr.summoner_name = si.summoner_name
      WHERE sr.queue = 'RANKED_SOLO_5x5'
      AND LOWER(sr.tier) IN ('challenger',
      'grandmaster', 'master')
      ORDER BY
      sr.lp DESC;
   </select>

   <select id="getRankFlexData" resultType="summoner_rank">
      SELECT sr.summoner_name,
      si.profile_icon_id, si.s_level, LOWER(sr.tier) as tier, sr.division,
      sr.wins, sr.losses, sr.lp, round((sr.wins/(si.games))*100,2) as
      winrate
      FROM summoner_rank sr
      INNER JOIN summoner_info si ON
      sr.summoner_name = si.summoner_name
      WHERE sr.queue = 'RANKED_FLEX_5x5'
      AND LOWER(sr.tier) IN ('challenger',
      'grandmaster', 'master')
      ORDER BY
      sr.lp DESC;
   </select>

   <select id="getRankLevelData" resultType="summoner">
      SELECT
      sr.summoner_name,
      si.profile_icon_id, si.s_level, LOWER(sr.tier) as
      tier, sr.division,
      sr.wins, sr.losses, sr.lp,
      round((sr.wins/(si.games))*100,2) as
      winrate
      FROM summoner_rank sr
      INNER
      JOIN summoner_info si ON
      sr.summoner_name = si.summoner_name
      WHERE
      sr.queue = 'RANKED_SOLO_5x5'
      ORDER BY
      si.s_level DESC;
   </select>

   <select id="get_summoner_info" resultType="summoner">
	SELECT
	  summoner_name, s_level, profile_icon_id, games, LOWER(tier) AS tier,
	  wins, losses, lp, ranking, revision_date,
	  tier_int
	FROM summoner_info
	WHERE summoner_name = #{summoner_name}
	ORDER BY revision_date DESC
	LIMIT 1;
   </select>

   <select id="get_renewal_info" resultType="summoner">
      SELECT * FROM
      SUMMONER_INFO
      WHERE summoner_name = ${summoner_name}
   </select>

<select id="get_summoner_record" resultType="record">
	
</select>

<select id="get_champ_record" resultType="champ_record">
  SELECT
    COUNT(*) AS games,
    ROUND((SUM(CASE WHEN win = 1 THEN 1 ELSE 0 END) / COUNT(*)) * 100,2) AS winrate,
    ROUND((SUM(kills) + SUM(assists)) / SUM(deaths),1) AS kda,
    SUM(kills) AS kills,
    SUM(deaths) AS deaths,
    SUM(assists) AS assists,
    SUM(CS) AS cs,
    ROUND(SUM(CS) / COUNT(*), 2) AS cs_per_minute,
    champ_name,
    COUNT(*) AS total_games,
    SUM(CASE WHEN win = 1 THEN 1 ELSE 0 END) AS wins,
    SUM(CASE WHEN win = 0 THEN 1 ELSE 0 END) AS losses
  FROM
    record
  WHERE
    summoner_name = #{summoner_name}
  GROUP BY
    champ_name;
</select>


	<select id="getChampSolo">
      SELECT
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND win = 1) AS
      wins,
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND win = 0) AS
      losses,
      champ_name,
      COUNT(*) AS games,
      (SUM(CASE WHEN win = 1 THEN 1 ELSE 0 END) / COUNT(*)) * 100 AS winrate,
      (SUM(kills) + SUM(assists)) / SUM(deaths) AS KDA,
      SUM(kills) AS kills,
      SUM(deaths) AS deaths,
      SUM(assists) AS assists,
      SUM(CS) AS CS,
      ROUND(SUM(CS) / COUNT(*), 2) AS CS_per_minute
      FROM
      record
      WHERE
      summoner_name = #{summoner_name}
      GROUP BY
      champ_name;
   </select>

    <select id="getChampFlex">
      SELECT
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND win = 1) AS
      wins,
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND win = 0) AS
      losses,
      champ_name,
      COUNT(*) AS games,
      (SUM(CASE WHEN win = 1 THEN 1 ELSE 0 END) / COUNT(*)) * 100 AS winrate,
      (SUM(kills) + SUM(assists)) / SUM(deaths) AS KDA,
      SUM(kills) AS kills,
      SUM(deaths) AS deaths,
      SUM(assists) AS assists,
      SUM(CS) AS CS,
      ROUND(SUM(CS) / COUNT(*), 2) AS CS_per_minute
      FROM
      record
      WHERE
      summoner_name = #{summoner_name}
      GROUP BY
      champ_name;
   </select>

    <select id="getChampClassic">
      SELECT
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND win = 1) AS
      wins,
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND win = 0) AS
      losses,
      champ_name,
      COUNT(*) AS games,
      (SUM(CASE WHEN win = 1 THEN 1 ELSE 0 END) / COUNT(*)) * 100 AS winrate,
      (SUM(kills) + SUM(assists)) / SUM(deaths) AS KDA,
      SUM(kills) AS kills,
      SUM(deaths) AS deaths,
      SUM(assists) AS assists,
      SUM(CS) AS CS,
      ROUND(SUM(CS) / COUNT(*), 2) AS CS_per_minute
      FROM
      record
      WHERE
      summoner_name = #{summoner_name}
      GROUP BY
      champ_name;
   </select>

    <select id="get_20games_summary" resultType = "recordsummary">
      SELECT
        (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND win = 1) AS wins,
        (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND win = 0) AS losses,
        ROUND((SUM(CASE WHEN win = 1 THEN 1 ELSE 0 END) / COUNT(*)) * 100, 2) AS winrate,
        ROUND(SUM(kills) / COUNT(*), 1) AS kills_avg,
      ROUND(SUM(deaths) / COUNT(*), 1) AS deaths_avg,
      ROUND(SUM(assists) / COUNT(*), 1) AS assists_avg,
      ROUND(SUM(kda) / COUNT(*), 1) AS kda_avg,
      MAX(kda) AS max_kda,
      (SELECT kills FROM record WHERE summoner_name = #{summoner_name} ORDER BY kda DESC LIMIT 1) AS max_kills,
      (SELECT deaths FROM record WHERE summoner_name = #{summoner_name} ORDER BY kda DESC LIMIT 1) AS max_deaths,
      (SELECT assists FROM record WHERE summoner_name = #{summoner_name} ORDER BY kda DESC LIMIT 1) AS max_assists,
      (select lower(lane) from (select lane, count(*) as lane_count from record where summoner_name = #{summoner_name} group by lane order by lane_count desc limit 1) as sub1) as most_lane1,
	  (select lower(lane) from (select lane, count(*) as lane_count from record where summoner_name = #{summoner_name} group by lane order by lane_count desc limit 1, 1) as sub2) as most_lane2,
	  ROUND((SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND lane = (SELECT lane FROM (SELECT lane, COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane ORDER BY lane_count DESC LIMIT 1) AS sub3)) / (SELECT SUM(lane_count) AS total_count FROM (SELECT COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane) AS sub4) * 100 , 2) AS most_lane_pickrate1,
	  ROUND((SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND lane = (SELECT lane FROM (SELECT lane, COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane ORDER BY lane_count DESC LIMIT 1, 1) AS sub5)) / (SELECT SUM(lane_count) AS total_count FROM (SELECT COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane) AS sub6) * 100 , 2) AS most_lane_pickrate2,
      (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1) AS subquery1) AS top_champ1,
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1) AS subquery1) AND win = 1) AS top_champ1_wins,
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1) AS subquery1) AND win = 0) AS top_champ1_losses,
      ROUND((SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1) AS subquery1) AND win = 1) / (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1) AS subquery1)) * 100, 2) AS top_champ1_winrate,
      ROUND(SUM(CASE WHEN champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1) AS subquery1) THEN kda ELSE 0 END) / COUNT(*), 2) AS top_champ1_kda_avg,
      (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1, 1) AS subquery2) AS top_champ2,
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1, 1) AS subquery2) AND win = 1) AS top_champ2_wins,
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1, 1) AS subquery2) AND win = 0) AS top_champ2_losses,
      ROUND((SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1, 1) AS subquery2) AND win = 1) / (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1, 1) AS subquery2)) * 100, 2) AS top_champ2_winrate,
      ROUND(SUM(CASE WHEN champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 1, 1) AS subquery2) THEN kda ELSE 0 END) / COUNT(*), 2) AS top_champ2_kda_avg,
      (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 2, 1) AS subquery3) AS top_champ3,
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 2, 1) AS subquery3) AND win = 1) AS top_champ3_wins,
      (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 2, 1) AS subquery3) AND win = 0) AS top_champ3_losses,
      ROUND((SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 2, 1) AS subquery3) AND win = 1) / (SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 2, 1) AS subquery3)) * 100, 2) AS top_champ3_winrate,
      ROUND(SUM(CASE WHEN champ_name = (SELECT champ_name FROM (SELECT champ_name, COUNT(*) AS champ_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY champ_name ORDER BY champ_count DESC LIMIT 2, 1) AS subquery3) THEN kda ELSE 0 END) / COUNT(*), 2) AS top_champ3_kda_avg
      FROM record
      WHERE summoner_name = #{summoner_name};
   </select>

   <select id="get_champ_position_filter" resultType="ChampRecordFilter">
      SELECT DISTINCT
    (SELECT LOWER(lane) FROM (SELECT lane, COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane ORDER BY lane_count DESC LIMIT 1) AS sub1) AS lane1,
    (SELECT LOWER(lane) FROM (SELECT lane, COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane ORDER BY lane_count DESC LIMIT 1, 1) AS sub2) AS lane2,
    (SELECT LOWER(lane) FROM (SELECT lane, COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane ORDER BY lane_count DESC LIMIT 2, 1) AS sub3) AS lane3,
    ROUND((SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND lane = (SELECT lane FROM (SELECT lane, COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane ORDER BY lane_count DESC LIMIT 1) AS sub3)) / (SELECT SUM(lane_count) AS total_count FROM (SELECT COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane) AS sub4) * 100 , 2) AS pickrate1,
    ROUND((SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND lane = (SELECT lane FROM (SELECT lane, COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane ORDER BY lane_count DESC LIMIT 1, 1) AS sub5)) / (SELECT SUM(lane_count) AS total_count FROM (SELECT COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane) AS sub6) * 100 , 2) AS pickrate2,
    ROUND((SELECT COUNT(*) FROM record WHERE summoner_name = #{summoner_name} AND lane = (SELECT lane FROM (SELECT lane, COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane ORDER BY lane_count DESC LIMIT 2, 1) AS sub7)) / (SELECT SUM(lane_count) AS total_count FROM (SELECT COUNT(*) AS lane_count FROM record WHERE summoner_name = #{summoner_name} GROUP BY lane) AS sub8) * 100 , 2) AS pickrate3
  FROM record
  WHERE summoner_name = #{summoner_name}
  GROUP BY lane;
   </select>

 <select id="get_record_detail" resultType="record">
	SELECT
  r.summoner_name AS summoner_name,
  r.win as win,
  r.team_tower_kills AS team_tower_kills,
  r.team_dragon_kills AS team_dragon_kills,
  r.team_baron_kills AS team_baron_kills,
  r.team_id AS team_id,
  r.team_champion_kills AS team_champion_kills,
  r.team_champion_deaths AS team_champion_deaths,
  (SELECT SUM(assists) FROM record WHERE match_id = #{match_id} AND team_id = r.team_id) AS team_champion_assists,
  r.champ_name AS champ_name,
  r.champ_level AS champ_level,
  r.spell1 AS spell1,
  r.spell2 AS spell2,
  r.main_rune AS main_rune,
  r.main_rune1 AS main_rune1,
  r.sub_rune AS sub_rune,
  r.kills AS kills,
  r.deaths AS deaths,
  r.assists AS assists,
  r.kda AS kda,
  r.cs AS cs,
  r.red_ward_placed AS red_ward_placed,
  r.dealt_to_champ AS dealt_to_champ,
  r.item1 AS item1,
  r.item2 AS item2,
  r.item3 AS item3,
  r.item4 AS item4,
  r.item5 AS item5,
  r.item6 AS item6,
  r.item7 AS item7,
  LOWER(si.tier) AS tier
FROM
  record r
  JOIN summoner_info si ON r.summoner_name = si.summoner_name
  JOIN record s ON r.team_id = s.team_id
WHERE
  r.match_id = '#{match_id}
GROUP BY
  r.summoner_name,
  r.win,
  r.team_tower_kills,
  r.team_dragon_kills,
  r.team_baron_kills,
  r.team_id,
  r.team_champion_kills,
  r.team_champion_deaths,
  r.champ_name,
  r.champ_level,
  r.spell1,
  r.spell2,
  r.main_rune,
  r.main_rune1,
  r.sub_rune,
  r.kills,
  r.deaths,
  r.assists,
  r.kda,
  r.cs,
  r.red_ward_placed,
  r.dealt_to_champ,
  r.item1,
  r.item2,
  r.item3,
  r.item4,
  r.item5,
  r.item6,
  r.item7,
  si.tier;
</select>

<select id="getBuild" resultType="build">
   SELECT
   t.mini_t_time AS
   timestamp,
   t.item_id,
   t.mini_t_skill_slot,
   r.main_rune,
   r.main_rune1,
   r.main_rune2,
   r.main_rune3,
   r.main_rune4,
   r.sub_rune,
   r.sub_rune1,
   r.sub_rune2,
   r.rune_stat1,
   r.rune_stat2,
   r.rune_stat3
   FROM
   time_line_data t
   LEFT JOIN
   record r ON t.match_id = r.match_id AND t.summoner_name =
   r.summoner_name
   WHERE
   t.match_id = #{matchId}
   AND t.summoner_name =
   #{summonerName}
</select>

<!--   <resultMap id="recordRanking" type="recordRanking">
    <id property="self_dealt" column="self_dealt"/>
    <id property="self_taken" column="self_taken"/>
    <id property="self_kills" column="self_kills"/>
    <id property="self_deaths" column="self_deaths"/>
    <id property="self_assists" column="self_assists"/>
    <id property="self_red_ward_placed" column="self_red_ward_placed"/>
    <id property="self_cs" column="self_cs"/>
    <id property="total_dealt" column="total_dealt"/>
    <id property="total_taken" column="total_taken"/>
    <id property="team_champion_kills" column="team_champion_kills"/>
    <id property="team_champion_deaths" column="team_champion_deaths"/>
    <id property="team_champion_assists" column="team_champion_assists"/>
    <id property="team_total_red_ward" column="team_total_red_ward"/>
    <id property="team_total_cs" column="team_total_cs"/>
    <collection property="team_dealt" ofType="recordRanking" javaType = "java.util.ArrayList">
        <id property="team_dealt" column="team_dealt"/>
    </collection>
    <collection property="team_taken" ofType="recordRanking" javaType = "java.util.ArrayList">
        <id property="team_taken" column="team_taken"/>
    </collection>
    <collection property="team_kills" ofType="recordRanking" javaType = "java.util.ArrayList">
        <id property="team_kills" column="team_kills"/>
    </collection>
    <collection property="team_deaths" ofType="recordRanking" javaType = "java.util.ArrayList">
        <id property="team_deaths" column="team_deaths"/>
    </collection>
    <collection property="team_assists" ofType="recordRanking" javaType = "java.util.ArrayList">
        <id property="team_assists" column="team_assists"/>
    </collection>
    <collection property="team_red_ward_placed" ofType="recordRanking">
        <id property="team_red_ward_placed" column="team_red_ward_placed"/>
    </collection>
    <collection property="team_cs" ofType="recordRankingCSType">
        <id property="team_cs" column="team_cs"/>
    </collection>    
</resultMap> -->

<select id="getRanking" resultType="recordRanking">
   select
   (select dealt_to_champ from record where match_id = #{match_id} and summoner_name = #{summoner_name}) as self_dealt,
   (select damage_taken from record where match_id = #{match_id} and summoner_name = #{summoner_name}) as self_taken,
   (select kills from record where match_id = #{match_id} and summoner_name = #{summoner_name}) as self_kills,
   (select deaths from record where match_id = #{match_id} and summoner_name = #{summoner_name}) as self_deaths,
   (select assists from record where match_id = #{match_id} and summoner_name = #{summoner_name}) as self_assists,
   (select red_ward_placed from record where match_id = #{match_id} and summoner_name = #{summoner_name}) as self_red_ward_placed,
   (select cs from record where match_id = #{match_id} and summoner_name = #{summoner_name}) as self_cs,
   (SELECT dealt_to_champ FROM record WHERE match_id = #{match_id} AND summoner_name &lt;&gt; #{summoner_name} AND team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_dealt,
   (SELECT damage_taken FROM record WHERE match_id = #{match_id} AND summoner_name &lt;&gt; #{summoner_name} AND team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_taken,
   (SELECT kills FROM record WHERE match_id = #{match_id} AND summoner_name &lt;&gt; #{summoner_name} AND team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_kills,
   (SELECT deaths FROM record WHERE match_id = #{match_id} AND summoner_name &lt;&gt; #{summoner_name} AND team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_deaths,
   (SELECT assists FROM record WHERE match_id = #{match_id} AND summoner_name &lt;&gt; #{summoner_name} AND team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_assists,
   (SELECT red_ward_placed FROM record WHERE match_id = #{match_id} AND summoner_name &lt;&gt; #{summoner_name} AND team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_red_ward_placed,
   (SELECT cs FROM record WHERE match_id = #{match_id} AND summoner_name &lt;&gt; #{summoner_name} AND team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_cs,
   (select SUM(dealt_to_champ) from record where match_id = #{match_id} and team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as total_dealt,
   (select SUM(damage_taken) from record where match_id = #{match_id} and team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as total_taken,
   (select team_champion_kills from record where match_id = #{match_id} and summoner_name = #{summoner_name} and team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_champion_kills,
   (select team_champion_deaths from record where match_id = #{match_id} and summoner_name = #{summoner_name} and team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_champion_deaths,
   (select SUM(assists) from record where match_id = #{match_id} and team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_champion_assists,
   (select sum(red_ward_placed) from record where match_id = #{match_id} and team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_total_red_ward,
   (select sum(cs) from record where match_id = #{match_id} and team_id = (SELECT team_id FROM record WHERE match_id = #{match_id} AND summoner_name = #{summoner_name})) as team_total_cs;
</select>

<select id="getSummoner" resultType="summoner">
   select summoner_name,
   LOWER(tier) as tier,
   profile_icon_id,
   games,
   wins,
   losses,
   lp,
   round((wins /
   games) * 100,2) as winrate
   from summoner_info
   where summoner_name =
   "8찬이하밥상엎음"
</select>

<select id="getDashBoardKDA" resultType="dashboard">
SELECT COUNT(CASE WHEN win = 1 THEN 1 END) AS wins,
COUNT(CASE WHEN win = 0 THEN 1 END) AS losses,
SUM(kills) / 20 AS kills_avg,
SUM(deaths) / 20 AS deaths_avg,
SUM(assists) / 20 AS assists_avg,
SUM(kda) / 20 AS kda_avg
FROM record
WHERE summoner_name 
= #{summoner_name} LIMIT 20;
</select>

</mapper>